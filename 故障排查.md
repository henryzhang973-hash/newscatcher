# GitHub Actions 故障排查指南

## ❌ 错误：Process completed with exit code 1

### 可能的原因和解决方法

#### 1. 配置文件不存在

**错误信息**：`配置文件 config.yaml 不存在`

**解决方法**：
- 确保 `config.yaml` 文件在仓库根目录
- 检查文件是否已提交到 Git

**验证**：
```bash
ls -la config.yaml
```

---

#### 2. Secrets 未配置

**错误信息**：`未配置 AI_API_KEY` 或 `未配置 FEISHU_WEBHOOK_URL`

**解决方法**：
1. 进入仓库：`Settings` → `Secrets and variables` → `Actions`
2. 检查以下 Secrets 是否已配置：
   - ✅ `AI_API_KEY`（必填）
   - ✅ `FEISHU_WEBHOOK_URL`（必填）
   - ⚠️ `AI_BASE_URL`（DeepSeek 必填）
   - ⚠️ `AI_MODEL`（可选，有默认值）

**验证**：
- 在 workflow 的 "Verify configuration" 步骤中会显示检查结果

---

#### 3. AI API 调用失败

**错误信息**：`AI 总结失败: ...`

**可能原因**：
- API Key 无效或过期
- API 地址不正确
- 模型名称错误
- 网络问题

**解决方法**：
1. 检查 `AI_API_KEY` 是否正确
2. 检查 `AI_BASE_URL` 是否正确（DeepSeek: `https://api.deepseek.com`）
3. 检查 `AI_MODEL` 是否正确（DeepSeek: `deepseek-chat`）
4. 查看 Actions 日志中的详细错误信息

---

#### 4. 飞书推送失败

**错误信息**：`飞书推送失败`

**可能原因**：
- Webhook URL 不正确
- 飞书机器人未启用
- 网络问题

**解决方法**：
1. 检查 `FEISHU_WEBHOOK_URL` 是否正确
2. 验证飞书机器人是否已启用
3. 测试 Webhook：`curl -X POST "你的webhook" -d '{"msg_type":"text","content":{"text":"测试"}}'`

**注意**：飞书推送失败不会导致程序失败（退出码 0），但会在日志中显示警告。

---

#### 5. 数据抓取失败

**错误信息**：`未获取到任何新闻`

**可能原因**：
- 数据源暂时不可用
- 网络问题
- 请求频率过高

**解决方法**：
- 等待一段时间后重试
- 检查网络连接
- 查看 Actions 日志中的详细错误

---

## 🔍 查看详细日志

在 GitHub Actions 中：

1. 进入仓库的 **Actions** 标签页
2. 点击失败的 workflow run
3. 展开 "Run news summarizer" 步骤
4. 查看完整的错误输出

## 📋 检查清单

运行前确保：

- [ ] `config.yaml` 文件存在
- [ ] `AI_API_KEY` Secret 已配置
- [ ] `FEISHU_WEBHOOK_URL` Secret 已配置
- [ ] `AI_BASE_URL` Secret 已配置（DeepSeek）
- [ ] `AI_MODEL` Secret 已配置（可选）
- [ ] 所有文件已提交到 Git

## 🧪 本地测试

在推送前，可以在本地测试：

```bash
cd /Users/henryzhang/TrendRadar/newscatcher

# 设置环境变量
export AI_API_KEY="你的token"
export AI_BASE_URL="https://api.deepseek.com"
export AI_MODEL="deepseek-chat"
export FEISHU_WEBHOOK_URL="你的webhook"

# 运行测试
python main.py
```

如果本地运行成功，GitHub Actions 也应该能成功。

